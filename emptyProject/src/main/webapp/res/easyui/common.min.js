var Action={ajsxSucc:function(a,b){if(b){b(a)}},jsonAsyncActByData:function(a,b,c){$.ajax({type:"POST",url:a,async:true,traditional:true,dataType:"json",data:b,success:function(d){Action.ajsxSucc(d,c)},error:function(f,e,d){Action._showError("后台出错，请查看日志")}})},post:function(a,b,c){this.jsonAsyncActByData(a,b,c)},jsonSyncActByData:function(a,b,c){$.ajax({type:"POST",url:a,async:false,traditional:true,dataType:"json",data:b,success:function(d){Action.ajsxSucc(d,c)},error:function(f,e,d){Action._showError("后台出错，请查看日志")}})},postSync:function(a,b,c){this.jsonSyncActByData(a,b,c)},getQueryString:function(d){var b=location.href;b=b.toLowerCase();d=d.toLowerCase();if(b.indexOf("?")==-1){return""}var a=b.split("?");a=a[a.length-1];a=a.split("&");for(var c=0;c<a.length;c++){var e=a[c].split("=");if(e[0]==d){return e[1]}}return""},execResult:function(a,b){if(a&&a.success){b&&b(a)}else{var c=a.message;c=c+"<br>"+this.buildValidateError(a);MsgUtil.error(c)}},buildValidateError:function(a){if(a.messages&&a.messages.length>0){var b=a.messages;return'<span style="color:red;">'+b.join("<br>")+"</span>"}else{return""}},_showError:function(c,b){b=b||"提示";var a=parent.$||a;a.messager.show({title:b,msg:c,style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop,bottom:""}})}};var Crud=(function(){var a=function(){return true};var b=function(c){this.addUrl=c.addUrl;this.listUrl=c.listUrl;this.updateUrl=c.updateUrl;this.delUrl=c.delUrl;this.searchFormId=c.searchFormId;this.pk=c.pk;this.encryptConfig=c.encryptConfig;this.onBeforeSave=c.onBeforeSave||a;this.$dlg=$("#"+c.dlgId);this.$form=$("#"+c.formId);this.$grid=$("#"+c.gridId);this.gridType="datagrid";this.submitUrl};b.prototype={add:function(c){c=c||"添加";this.$dlg.dialog("open").dialog("setTitle",c);this.$form.form("reset");this.submitUrl=this.addUrl;if(this._hasPkInput()){this.getPkInput().prop("disabled",false)}},update:function(d,c){c=c||"修改";if(d){this.$dlg.dialog("open").dialog("setTitle",c);this.$form.form("clear").form("load",d);this.submitUrl=this.updateUrl+["?",this.pk,"=",d[this.pk]].join("");if(this._hasPkInput()){this.getPkInput().prop("disabled",true)}}},load:function(c){if(this.listUrl){this.runGridMethod("load",c)}},search:function(){var c=Crud.getFormData(this.searchFormId);this.load(c)},runGridMethod:function(c,d){this.$grid[this.gridType](c,d)},_hasPkInput:function(){return this.getPkInput().length>0},getPkInput:function(){if(!this.pkInput){this.pkInput=this.getByName(this.pk)}return this.pkInput},getByName:function(c){return this.$form.find("[name="+c+"]")},del:function(e,d){d=d||"确定要删除该数据吗?";var c=this;if(e){$.messager.confirm("Confirm",d,function(f){if(f){Action.post(c.delUrl,e,function(g){Action.execResult(g,function(h){c.runGridMethod("reload")})})}})}},save:function(){var c=this;this.$form.form("submit",{url:this.submitUrl,onSubmit:function(){var d=c.onBeforeSave(c);if((typeof d!=undefined)&&d===false){return false}return $(this).form("validate")},success:function(e){var d=$.parseJSON(e);Action.execResult(d,function(f){c.$dlg.dialog("close");c.runGridMethod("reload")})}})},createOperColumn:function(c){return Crud.createOperColumn(c)},createEditColumn:function(c){c=$.isArray(c)?c:[];var e=this;var d=[{text:"修改",onclick:function(f){e.update(f)}},{text:"删除",onclick:function(f){e.del(f)}}].concat(c);return this.createOperColumn(d)},createOperFormatter:function(c){return Crud.createOperFormatter(c)},buildGrid:function(d,c){var e={url:this.listUrl,columns:[d],toolbar:"#toolbar",pagination:true,fitColumns:true,singleSelect:true,striped:true,pageSize:20,loadFilter:function(f){if(f.message){MsgUtil.error(f.message,"查询出错")}return f}};$.extend(e,c);return this.$grid.datagrid(e)},buildTreegrid:function(d,c){this.gridType="treegrid";var e={url:this.listUrl,columns:[d],toolbar:"#toolbar",fitColumns:true,animate:false,collapsible:true,pageSize:20,loadFilter:function(f){if(f.message){MsgUtil.error(f.message,"查询出错")}return f}};$.extend(e,c);this.$grid.treegrid(e)},closeDlg:function(){this.$dlg.dialog("close")}};return{create:function(c){return new b(c)},createOperColumn:function(c){if($.isArray(c)&&c.length>0){return{field:"_operate",title:"操作",align:"center",formatter:this.createOperFormatter(c)}}return undefined},createOperFormatter:function(c){c=$.isArray(c)?c:[];var d=function(m,l,g){var k=[];for(var j=0,f=c.length;j<f;j++){var h=c[j];var e=h.showFun||function(){return true};if(e(l)){k.push('<a href="javascript:void(0)" onclick="'+FunUtil.createFun(h,"onclick",l,m,g)+'">'+h.text+"</a>")}}return k.join('<span style="color:#808080;padding:0 4px;">|</span>')};return d},getFormData:function(d){var c=$("#"+d).serializeArray();var e={};$.each(c,function(f,h){var g=h.value;if(e[h.name]){var j=e[h.name];if($.isArray(j)){j.push(g)}else{e[h.name]=[j,g]}}else{e[h.name]=g}});return e}}})();var EventUtil={getEvent:function(){if(window.event){return this.formatEvent(window.event)}else{return this.getEvent.caller.arguments[0]}},formatEvent:function(a){if($.browser.msie){a.charCode=(a.type=="keypress")?a.charCode:0;a.eventPhase=2;a.isChar=(a.charCode>0);a.pageX=a.clientX+document.body.scrollLeft;a.pageY=a.clientY+document.body.scrollTop;a.preventDefault=function(){this.returnValue=false};if(a.type=="mouseout"){a.relateTarget=a.toElement}else{if(a.type=="mouseover"){a.relateTarget=a.fromElement}}a.stopPropagation=function(){this.cancelBubble=true};a.target=a.srcElement;a.timestamp=(new Date()).getTime()}return a}};var FunUtil=(function(){var b=0;var a=[];return{createFun:function(h,f){var e=b++;var d=[];for(var g=2,c=arguments.length;g<c;g++){d.push(arguments[g])}a[e]=(function(k,j,i){return function(){k[j].apply(k,i)}}(h,f,d));return"FunUtil._runFun(event,"+e+");"},_runFun:function(f,c){var d=a[c];d();if(typeof f.preventDefault==="function"){f.preventDefault();f.stopPropagation()}else{f.returnValue=false;f.cancelBubble=true}}}})();if(typeof(jQuery)!="undefined"){$(document).ajaxError(function(c,b,a){if(b.getResponseHeader("X-timeout")&&b.status==401){top.location.href=ctx+"needLogin.html"}else{alert("系统异常")}})}var Globle={logout:function(){$.ajax({type:"POST",url:ctx+"logout.do",dataType:"json",success:function(a){if(a.success){location.reload()}},error:function(){location.reload()}})},clearPanel:function(){return function(){var a=$("iframe",this);if(a.length>0){a.remove()}}}};$.fn.panel.defaults.onBeforeDestroy=function(){var c=$("iframe",this);try{if(c.length>0){for(var a=0;a<c.length;a++){c[a].src="";c[a].contentWindow.document.write("");c[a].contentWindow.close()}c.remove();if(navigator.userAgent.indexOf("MSIE")>0){try{CollectGarbage()}catch(b){}}}}catch(b){}};var easyuiPanelOnMove=function(b,f){var c=b;var j=f;if(c<1){c=1}if(j<1){j=1}var a=parseInt($(this).parent().css("width"))+14;var h=parseInt($(this).parent().css("height"))+14;var g=c+a;var e=j+h;var i=$(window).width();var d=$(window).height();if(g>i){c=i-a}if(e>d){j=d-h}$(this).parent().css({left:c,top:j})};$.fn.dialog.defaults.onMove=easyuiPanelOnMove;$.fn.window.defaults.onMove=easyuiPanelOnMove;$.fn.panel.defaults.onMove=easyuiPanelOnMove;$.fn.datagrid.defaults.loadFilter=function(a){if(a.message){MsgUtil.error(a.message,"查询出错")}return a};function getFormData(b){var a=b.serializeArray();var c={};$.each(a,function(d,f){var e=f.value;if(c[f.name]){var g=c[f.name];if($.isArray(g)){g.push(e)}else{c[f.name]=[g,e]}}else{c[f.name]=e}});return c}var HtmlUtil=(function(){var a={"<":"&lt;",">":"&gt;","\r\n":"<br>"," ":"&nbsp;","\t":"&nbsp;&nbsp;&nbsp;&nbsp;"};var c={"&nbsp;":" ","<br ?/?>":"\r\n","&lt;":"<","&gt;":">"};function b(e,f){for(var d in f){e=e.replace(new RegExp(d,"g"),f[d])}return e}return{parseToHtml:function(d){return b(d,a)},parseToText:function(d){return b(d,c)}}}());var MaskUtil=(function(){var b,a;var d="正在处理，请稍待。。。";function c(){if(!b){b=$('<div class="datagrid-mask mymask"></div>').appendTo("body")}if(!a){a=$('<div class="datagrid-mask-msg mymask">'+d+"</div>").appendTo("body").css({"font-size":"12px"})}b.css({width:"100%",height:$(document).height()});var e=$(document.body).scrollTop();a.css({left:($(document.body).outerWidth(true)-190)/2,top:(($(window).height()-45)/2)+e})}return{mask:function(e){c();b.show();a.html(e||d).show()},unmask:function(){b.hide();a.hide()}}}());var MsgUtil={topMsg:function(b,a){a=a||"提示";this.getJQ().messager.show({title:a,msg:b,showSpeed:300,style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop,bottom:""}})},alert:function(c,b,a){b=b||"提示";a=a||"info";if(c&&c.length>1000){this.getJQ().messager.show({title:b,msg:'<div style="height:300px;overflow-y: auto; overflow-x:hidden;">'+c+"</div>",width:600,height:350,showType:null,timeout:0,style:{right:"",bottom:""}})}else{this.getJQ().messager.alert(b,c,a)}},error:function(b,a){a=a||"错误";this.alert(b,a,"error")},confirm:function(b,c,a){a=a||"确认";this.getJQ().messager.confirm(a,b,function(d){if(d){c()}})},getJQ:function(){return top.$||$}};